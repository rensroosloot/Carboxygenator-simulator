# Changelog

All meaningful changes to this project are tracked here.

## [Unreleased]
- Date: `2026-02-19`
- Summary: Added CO2 permeability parameterization option with `perm_co2` input (Barrer or SI-like) and selectable CO2 transfer model (`kLa` or `Permeability`).
- Reason/Impact: Enables research-based CO2 transport specification directly from permeability data (e.g., 3250 Barrer) instead of relying only on manual CO2 `kLa`.
- Evidence: `ui/app.py`, `core/params.py`, `core/model.py`, `tests/test_params.py`, `tests/test_solver.py`, `docs/URS.md`, `docs/DS.md`, `docs/FS.md`, `docs/validation/RTM.md`, `docs/validation/TestProtocol.md`, `docs/validation/TestReport.md`, `docs/validation/RiskAssessment.md`
- Date: `2026-02-19`
- Summary: Updated gas-transfer defaults to research-based PDMS benchmark values: `N2=280`, `O2=600`, `CO2=3250` Barrer basis; set default `kla_co2_s_inv` to `kla_o2 * (3250/600)`.
- Reason/Impact: Aligns default CO2/O2/N2 transfer assumptions with the documented research basis instead of placeholder values.
- Evidence: `ui/app.py`, `core/params.py`, `deep-research-report.md`
- Date: `2026-02-19`
- Summary: Made one-row segmented panel order follow stage order; in reverse mode O2 panel renders left and CO2/pH panel renders right.
- Reason/Impact: Keeps visualization flow consistent with selected process direction.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Corrected CO2-panel `pH inlet` metric to show stage-local inlet pH in reverse mode (DO-output-fed pH stage).
- Reason/Impact: Aligns displayed pH stage inputs with actual reverse-order calculation path.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Added `Reverse pH/DO stage order` toggle to apply DO-section CO2 stripping before pH-section CO2 conditioning (DO output feeds pH input).
- Reason/Impact: Enables optional reversed process-order simulation and stage-order-aware pH/CO2 reporting without changing O2 transfer equations.
- Evidence: `ui/app.py`, `core/params.py`
- Date: `2026-02-19`
- Summary: Hid `pH after DO part` metric when upstream pH stage is disabled.
- Reason/Impact: Keeps O2 panel focused on DO-only outputs when pH workflow is not active.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Updated UI simulation defaults to `O2=100%`, `gas_flow_ml_min=2`, and `perfusion_speed_ml_min=4`.
- Reason/Impact: Aligns startup defaults with requested pure-O2 low-gas-flow operating scenario.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Added explicit staged pH readout sequence in segmented view: `pH inlet`, `pH after pH part`, and `pH after DO part`.
- Reason/Impact: Makes stage-by-stage pH progression visible and directly aligned with process order while preserving compact one-row panel layout.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Restored explicit inlet/outlet metrics above segmented panels: `DO2% inlet/outlet` for O2 section and `pH inlet/outlet` for CO2 pH stage.
- Reason/Impact: Improves quick interpretation of stage entry/exit conditions alongside segmented heatmaps.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Changed CO2-stage segmented visualization density to use approximately one segment per cm of CO2-stage length.
- Reason/Impact: Aligns CO2 panel granularity with short stage length (`16 cm` -> ~`16` segments) and avoids over-segmentation inherited from O2 defaults.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Adjusted one-row segmented visualization layout to fixed `25% CO2 / 75% O2` panel widths.
- Reason/Impact: Improves readability of the CO2 panel while retaining side-by-side comparison with O2.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Reworked segmented counterflow layout to display CO2-stage and O2-stage heatmaps in one row with proportional widths based on section lengths.
- Reason/Impact: Makes process-scale comparison explicit (`16 cm` CO2 stage vs `160 cm` O2 stage) and matches requested side-by-side visualization.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Updated CO2-stage segmented counterflow panel to use the same segment count density and chart height as the O2 segmented panel.
- Reason/Impact: Aligns visual step width/style between CO2 and O2 segmented views for easier direct comparison.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Updated CO2 pH-stage defaults and UI emphasis: `ph_gas_co2_percent` default set to `99%`, with pH-first inlet/outlet metrics replacing CO2 in/out display.
- Reason/Impact: Aligns default settings with high-CO2 pH-control use case and presents results in direct pH terms while keeping dissolved CO2 internal to calculations.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Added segmented counterflow visualization for the optional upstream CO2 pH-conditioning stage, including liquid CO2/gas CO2-potential lanes and liquid pH profile along stage position.
- Reason/Impact: Improves interpretability of the CO2 pre-conditioning section and shows how CO2 transfer and pH evolve before the O2 section.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Replaced deprecated Streamlit `use_container_width` chart argument with `width=\"stretch\"` in UI chart rendering.
- Reason/Impact: Removes Streamlit 1.54 deprecation warnings and keeps layout behavior unchanged for full-width charts.
- Evidence: `ui/app.py`
- Date: `2026-02-19`
- Summary: Added optional upstream CO2 pH-conditioning section with bicarbonate-buffer pH simulation and downstream CO2 stripping in the existing O2 section.
- Reason/Impact: Extends the tool to model a two-part process layout (CO2 then O2), adds pH/CO2 trend visualization and process schematic, and preserves existing O2/N2 workflow when the feature is disabled.
- Evidence: `core/model.py`, `core/params.py`, `core/__init__.py`, `ui/app.py`, `tests/test_params.py`, `tests/test_solver.py`, `docs/URS.md`, `docs/DS.md`, `docs/FS.md`, `docs/validation/ValidationPlan.md`, `docs/validation/RiskAssessment.md`, `docs/validation/RTM.md`, `docs/validation/TestProtocol.md`, `docs/validation/TestReport.md`, `README.md`
- Date: `2026-02-19`
- Summary: Added repository-root `sys.path` bootstrap in `ui/app.py` before importing `core`.
- Reason/Impact: Prevents `ModuleNotFoundError` on Streamlit Cloud when app is launched with main module `ui/app.py` instead of repository-root entrypoint.
- Evidence: `ui/app.py`, Streamlit Cloud traceback (`ModuleNotFoundError` at `from core import ...`)
- Date: `2026-02-19`
- Summary: Restricted project Python support range to `<4` in packaging metadata.
- Reason/Impact: Fixes Streamlit Cloud Poetry dependency resolution failure for `reportlab` caused by open-ended Python range including unsupported future major versions.
- Evidence: `pyproject.toml`, deployment log `logs-rensroosloot-carboxygenator-simulator-main-ui-app.py-2026-02-19T14_38_58.143Z.txt`
- Date: `2026-02-17`
- Summary: Added prepared experimental test matrix with model-predicted `DO2_out` values for planned lab validation runs.
- Reason/Impact: Enables direct prediction-vs-measurement comparison across gas flow and perfusion settings with fixed assumptions and measurement fields.
- Evidence: `docs/validation/ExperimentalTestMatrix_DO2_Outlet.md`
- Date: `2026-02-17`
- Summary: Updated experimental test matrix assumptions and predictions to pure O2 feed (`O2=100%`, `N2=0%`) with zero inlet dissolved gases (`DO2_in=0%`, `N2_in=0%`).
- Reason/Impact: Aligns planned experiment sheet with intended start-up boundary condition challenge test before measurement campaign.
- Evidence: `docs/validation/ExperimentalTestMatrix_DO2_Outlet.md`
- Date: `2026-02-17`
- Summary: Updated test matrix gas-flow range to constrained lab range (`1-20 mL/min`) and regenerated predicted `DO2_out` values.
- Reason/Impact: Keeps planned validation runs inside practical gas-flow operating limits while preserving prediction-vs-measurement traceability.
- Evidence: `docs/validation/ExperimentalTestMatrix_DO2_Outlet.md`
- Date: `2026-02-17`
- Summary: Updated matrix to a lower provisional pressure curve (`delta_p = 3.0 * gas_flow`) and added measured pressure-in fields.
- Reason/Impact: Aligns predictions with observed pressure behavior (`20 mL/min ~= 60 mbar`) and improves capture of measured inlet conditions for comparison.
- Evidence: `docs/validation/ExperimentalTestMatrix_DO2_Outlet.md`
- Date: `2026-02-17`
- Summary: Updated matrix to include perfusion-flow setpoints up to `20 mL/min` and restored standard `Conservative curve` (`delta_p = 4.0 * gas_flow`).
- Reason/Impact: Aligns planned lab matrix with requested perfusion operating range while keeping consistency with current in-app conservative pressure model.
- Evidence: `docs/validation/ExperimentalTestMatrix_DO2_Outlet.md`

## [0.1.0] - 2026-02-17
- First stable research MVP release of CarboxySim.
- Added single-pass O2/N2 transfer simulation with both `kLa` and permeability modes.
- Added gas-side O2 supply limitation and selectable pressure models.
- Added segmented depletion mode with counterflow visualization.
- Added transport-delay handling via configurable total hold-up volume.
- Added source-vessel perfect-mixing DO trajectory and time-to-target estimation.
- Added cell-demand based perfusion recommendation from O2 balance.
- Added exports:
  - Excel timeseries
  - Excel source-vessel trajectory
  - metadata JSON
  - PDF report with graphs + settings explanations + summary + flow-sweep table
- Completed GAMP5-style spec and validation documentation set (`URS`, `DS`, `FS`, validation artifacts).
- Released comprehensive README with assumptions, equations, usage, deployment, and interpretation guidance.

- Date: `2026-02-16`
- Summary: Initialized GAMP5 validation scaffolding and documentation governance.
- Reason/Impact: Establishes traceable development and validation workflow before implementation.
- Evidence: `docs/validation/ValidationPlan.md`, `docs/validation/RiskAssessment.md`, `docs/validation/RTM.md`, `docs/validation/TestProtocol.md`, `docs/validation/TestReport.md`, `AGENTS.md`
- Date: `2026-02-16`
- Summary: Added Phase B project skeleton and first core validation module.
- Reason/Impact: Introduces initial implementation (`SimulationInputs`, `validate_inputs`) and executable tests for input rules.
- Evidence: `core/params.py`, `core/__init__.py`, `tests/test_params.py`, `ui/app.py`, `pyproject.toml`
- Date: `2026-02-16`
- Summary: Recorded initial executed validation evidence.
- Reason/Impact: Keeps GAMP5 traceability current for implemented validation tests.
- Evidence: `docs/validation/RTM.md`, `docs/validation/TestReport.md`
- Date: `2026-02-16`
- Summary: Implemented core equilibrium and time-domain solver functions with AC-001..AC-006 test coverage.
- Reason/Impact: Adds first physics simulation capability and verifies deterministic, stable behavior against FS acceptance criteria.
- Evidence: `core/model.py`, `core/solver.py`, `core/results.py`, `core/__init__.py`, `tests/test_solver.py`, `docs/validation/RTM.md`, `docs/validation/TestReport.md`
- Date: `2026-02-16`
- Summary: Implemented export helpers and executed AC-007 export integrity test.
- Reason/Impact: Completes MVP core function contracts for file export and closes UR-008 traceability gap.
- Evidence: `core/results.py`, `core/__init__.py`, `tests/test_exports.py`, `docs/validation/RTM.md`, `docs/validation/TestReport.md`
- Date: `2026-02-16`
- Summary: Implemented working Streamlit UI for input-run-plot-export flow.
- Reason/Impact: Enables researchers to run the simulation interactively and download results without writing code.
- Evidence: `ui/app.py`, `pyproject.toml`
- Date: `2026-02-16`
- Summary: Migrated model to single-pass tubing residence-time transfer and added flow/tubing inputs.
- Reason/Impact: Aligns the simulator with source-to-waste measurement after carboxygenator tubing and supports flow-dependent transfer behavior.
- Evidence: `core/params.py`, `core/model.py`, `core/solver.py`, `core/results.py`, `core/__init__.py`, `ui/app.py`, `tests/test_params.py`, `tests/test_solver.py`, `tests/test_exports.py`, `docs/URS.md`, `docs/DS.md`, `docs/FS.md`, `docs/validation/RTM.md`, `docs/validation/TestProtocol.md`, `docs/validation/TestReport.md`
- Date: `2026-02-16`
- Summary: Added flow sweep visualization to Streamlit UI.
- Reason/Impact: Enables rapid sensitivity analysis of outlet O2/N2 concentration versus flow rate without repeated manual runs.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Updated UI to show DO% as primary output using air@1atm reference.
- Reason/Impact: Aligns visualization with how the experimental setup reports oxygenation (`DO%`), while retaining concentration outputs as secondary context.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Updated gas composition input to percentage mode with automatic 100% total constraint.
- Reason/Impact: Reduces user input errors and matches operational thinking in percent gas blends.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Changed initial dissolved O2/N2 UI inputs from mmol/L to percentage-based fields.
- Reason/Impact: Aligns initialization with DO-style operation while preserving internal mmol/L simulation calculations.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Added permeability-based transfer mode as alternative to kLa mode.
- Reason/Impact: Enables simulation using tubing geometry/material data when kLa is unknown.
- Evidence: `core/params.py`, `core/model.py`, `core/solver.py`, `core/__init__.py`, `ui/app.py`, `tests/test_params.py`, `tests/test_solver.py`, `tests/test_exports.py`, `docs/DS.md`, `docs/FS.md`, `docs/validation/RTM.md`, `docs/validation/TestProtocol.md`, `docs/validation/TestReport.md`
- Date: `2026-02-16`
- Summary: Fixed flow sweep to respect selected transfer model (`kLa` or `Permeability`).
- Reason/Impact: Prevents incorrect flat/zero sweep output when permeability mode is active.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Added permeability unit selector (`Barrer` or SI-like) and effective transfer diagnostics in UI.
- Reason/Impact: Prevents scale/unit mis-entry and makes low/high transfer behavior directly inspectable.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Added total O2 throughput metrics and flow-sweep plots in mmol/min.
- Reason/Impact: Makes it possible to compare concentration-vs-flow tradeoff on total delivered oxygen per minute.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Reworked `clausereview.md` for readability, scientific consistency, and alignment with current dual-mode model.
- Reason/Impact: Removes encoding/typo issues and gives actionable, up-to-date review findings.
- Evidence: `clausereview.md`
- Date: `2026-02-16`
- Summary: Replaced flow sweep charts with explicit Altair rendering and unit-safe field naming.
- Reason/Impact: Fixes unreliable sweep plotting behavior and preserves visible unit labels in axes/table.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Persisted last simulation run in session state so flow sweep controls update without re-running.
- Reason/Impact: Improves workflow by decoupling sweep interaction from the primary run button.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Added outer-shell diameter and gas-flow inputs with O2 supply limitation in the core model.
- Reason/Impact: Prevents unrealistic oxygen transfer when gas-side throughput is insufficient and exposes annulus/gas residence metrics.
- Evidence: `core/params.py`, `core/model.py`, `core/solver.py`, `core/__init__.py`, `ui/app.py`, `tests/test_params.py`, `tests/test_solver.py`, `tests/test_exports.py`, `docs/URS.md`, `docs/DS.md`, `docs/FS.md`, `docs/validation/RTM.md`, `docs/validation/TestProtocol.md`, `docs/validation/TestReport.md`
- Date: `2026-02-16`
- Summary: Added segmented gas-liquid depletion mode (`segmented`) alongside lumped mode.
- Reason/Impact: Captures axial gas composition depletion and gives stronger low-gas-flow limitation behavior where expected.
- Evidence: `core/params.py`, `core/solver.py`, `ui/app.py`, `tests/test_params.py`, `tests/test_solver.py`, `docs/URS.md`, `docs/DS.md`, `docs/FS.md`, `docs/validation/RTM.md`, `docs/validation/TestProtocol.md`, `docs/validation/TestReport.md`
- Date: `2026-02-16`
- Summary: Added selectable pressure models in UI (Manual, Conservative curve, Optimistic curve).
- Reason/Impact: Allows direct scenario comparison with measured flow-pressure behavior and automatic `p_total` derivation from gas flow.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Added calculated pressure visualization to flow sweep.
- Reason/Impact: Makes pressure-flow coupling directly visible in the sweep outputs and table.
- Evidence: `ui/app.py`
- Date: `2026-02-16`
- Summary: Updated formal docs and added `README.md` with setup, model explanation, and usage guidance.
- Reason/Impact: Aligns user-facing and validation documentation with current implementation state.
- Evidence: `README.md`, `docs/URS.md`, `docs/DS.md`, `docs/FS.md`, `docs/validation/RTM.md`, `docs/validation/TestProtocol.md`, `docs/validation/TestReport.md`
- Date: `2026-02-16`
- Summary: Added segmented counterflow color-bar visualization with 0-500% DO legend.
- Reason/Impact: Makes axial oxygenation/depletion patterns interpretable at a glance for both liquid and gas sides.
- Evidence: `ui/app.py`, `core/solver.py`, `tests/test_solver.py`, `README.md`
- Date: `2026-02-16`
- Summary: Added Windows launcher script for Streamlit app startup.
- Reason/Impact: Simplifies repeatable app startup with correct working directory and Python environment selection.
- Evidence: `start_app.bat`, `README.md`
